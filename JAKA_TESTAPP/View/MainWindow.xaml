<Window x:Class="JAKA_TESTAPP.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Robot Test" Height="800" Width="1200">
    <Window.Resources>
        <Style TargetType="Button" x:Key="TaskBtnStyle">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Background" Value="#DDDDFF"/>
            <Setter Property="IsEnabled" Value="{Binding IsConnected}"/>
        </Style>

        <Style TargetType="TextBox" x:Key="InputBoxStyle">
            <Setter Property="Height" Value="25"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="2"/>
        </Style>

        <Style TargetType="TextBlock" x:Key="LabelStyle">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <Style x:Key="IndicatorStyle" TargetType="Border">
            <Setter Property="Width" Value="25"/>
            <Setter Property="Height" Value="25"/>
            <Setter Property="CornerRadius" Value="12.5"/>
            <Setter Property="BorderBrush" Value="Gray"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="#EEE"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <GroupBox Grid.Row="0" Header="System Connection" Padding="5">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="IP:" VerticalAlignment="Center"/>
                <TextBox Text="{Binding RobotIp}" Width="120" Margin="5,0" VerticalContentAlignment="Center"/>
                <Button Content="{Binding ConnectBtnText}" Command="{Binding ConnectCommand}" Width="100"/>

                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="20,0"/>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Power" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <Border>
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource IndicatorStyle}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsPoweredOn}" Value="True">
                                        <Setter Property="Background" Value="LimeGreen"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                    </Border>

                    <TextBlock Text="Enable" VerticalAlignment="Center" Margin="10,0,5,0"/>
                    <Border>
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource IndicatorStyle}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsEnabled}" Value="True">
                                        <Setter Property="Background" Value="LimeGreen"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                    </Border>

                    <TextBlock Text="InPos" VerticalAlignment="Center" Margin="15,0,5,0"/>
                    <Border>
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource IndicatorStyle}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsInPos}" Value="True">
                                        <Setter Property="Background" Value="LimeGreen"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                    </Border>

                    <TextBlock Text="Protective Stop" VerticalAlignment="Center" Margin="10,0,5,0"/>
                    <Border>
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource IndicatorStyle}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsProtectiveStop}" Value="True">
                                        <Setter Property="Background" Value="Red"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                    </Border>

                    <TextBlock Text="Gripper Connection" VerticalAlignment="Center" Margin="15,0,5,0"/>
                    <Border>
                        <Border.Style>
                            <Style TargetType="Border" BasedOn="{StaticResource IndicatorStyle}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsGripperConnected}" Value="True">
                                        <Setter Property="Background" Value="LimeGreen"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                    </Border>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <Grid Grid.Row="1" Margin="0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="450"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <GroupBox Header="Real-time Monitoring" Grid.Column="0" Margin="0,0,10,0">
                <Grid Margin="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0">
                        <TextBlock Text="Joint Angles:" FontWeight="Bold"/>
                        <TextBlock Text="{Binding JointDisplay}" FontFamily="Consolas" Margin="0,5,0,15"/>
                    </StackPanel>

                    <StackPanel Grid.Row="1">
                        <TextBlock Text="End-point Coordinates (TCP)::" FontWeight="Bold"/>
                        <TextBlock Text="{Binding TcpDisplay}" FontFamily="Consolas" Margin="0,5,0,15"/>
                    </StackPanel>

                    <Button Grid.Row="2" 
                            Content="One-click Error Clearing" 
                            Command="{Binding RecoverCommand}" 
                            Background="Orange" Height="40" Margin="0,0,0,10"
                            Style="{StaticResource TaskBtnStyle}"/>

                    <GroupBox Grid.Row="3" Header="System Log" Padding="0">
                        <ListBox ItemsSource="{Binding LogList}" 
             Background="#F5F5F5" 
             FontFamily="Consolas" 
             FontSize="11"
             BorderThickness="0"
             ScrollViewer.VerticalScrollBarVisibility="Auto"
             ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="2"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                </Style>
                            </ListBox.ItemContainerStyle>

                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" TextWrapping="Wrap"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>

                        </ListBox>
                    </GroupBox>
                </Grid>
            </GroupBox>

            <GroupBox Header="Task Control Panel" Grid.Column="1">
                <Grid >
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10">
                        <Button Content="Power on" Command="{Binding PowerOnCommand}" Width="105" Height="40" Margin="15,5" Background="GreenYellow" Style="{StaticResource TaskBtnStyle}"/>
                        <Button Content="Enable" Command="{Binding EnableCommand}" Width="105" Height="40" Margin="15,5" Background="GreenYellow" Style="{StaticResource TaskBtnStyle}"/>
                        <Button Content="Gripper Init" Command="{Binding GripperInitCommand}" Width="105" Height="40" Margin="15,5" Background="#00FFFF" ToolTip="发送Modbus初始化指令 (0x0100=1)" Style="{StaticResource TaskBtnStyle}"/>
                        <Button Content="Gripper Open" Command="{Binding GripperOpenCommand}" Width="105" Height="40" Margin="15,5" Background="SkyBlue" Style="{StaticResource TaskBtnStyle}"/>
                        <Button Content="Gripper Close" Command="{Binding GripperCloseCommand}" Width="105" Height="40" Margin="15,5" Background="SkyBlue" Style="{StaticResource TaskBtnStyle}"/>
                    </StackPanel>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,5">
                        <StackPanel>
                            <GroupBox Header="Coordinate Control" Padding="5" Margin="0,0,0,10">
                                <StackPanel>

                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="10*"/>
                                            <ColumnDefinition Width="71*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Text="Input target coordinates:" VerticalAlignment="Center" FontWeight="Bold" Foreground="#555" Grid.ColumnSpan="2"/>

                                        <CheckBox 
                      Content="Lock Value (Edit Mode)" 
                      IsChecked="{Binding IsValueLocked}"
                      ToolTip="勾选后停止自动刷新，允许手动修改坐标"
                      VerticalAlignment="Center"
                      FontWeight="Bold"
                      Foreground="Crimson" HorizontalAlignment="Left" Width="160" Grid.Column="1" Margin="297,0,0,0"/>
                                    </Grid>

                                    <UniformGrid Columns="6">
                                        <TextBlock Text="X" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="Y" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="Z" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="RX" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="RY" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="RZ" Style="{StaticResource LabelStyle}"/>
                                    </UniformGrid>

                                    <UniformGrid Columns="6" Margin="0,2,0,5">
                                        <TextBox Text="{Binding InputX}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding InputY}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding InputZ}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding InputRX}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding InputRY}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding InputRZ}" Style="{StaticResource InputBoxStyle}"/>
                                    </UniformGrid>

                                    <Button Content="Go to the specified coordinates" Command="{Binding MoveToCoordinateCommand}" Height="35" Style="{StaticResource TaskBtnStyle}"/>
                                </StackPanel>
                            </GroupBox>

                            <GroupBox Header="Current Tool Coordinate System" Padding="5" Margin="0,0,0,5" Background="#EFFFFF">
                                <StackPanel Orientation="Vertical">
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                        <TextBlock Text="Current ID:" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding CurrentToolIdDisplay}" Margin="5,0,15,0" Foreground="Red"/>
                                        <TextBlock Text="Current Name:" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding CurrentToolNameDisplay}" Margin="5,0,0,0" Foreground="Red"/>
                                    </StackPanel>
                                    <TextBlock TextWrapping="Wrap">
            <Run Text="Current offset:" FontWeight="Bold"/>
            <Run Text="{Binding CurrentToolOffsetDisplay}" FontSize="10" Foreground="Red"/>
                                    </TextBlock>
                                </StackPanel>
                            </GroupBox>

                            <GroupBox Header="Tool coordinate system setting" Padding="5">
                                <StackPanel>
                                    <Grid Margin="0,0,0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="50"/>
                                            <ColumnDefinition Width="20"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="Tool ID:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Text="{Binding ToolId}" Style="{StaticResource InputBoxStyle}"/>

                                        <TextBlock Grid.Column="3" Text="Tool Name:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="4" Text="{Binding ToolName}" Style="{StaticResource InputBoxStyle}"/>
                                    </Grid>

                                    <TextBlock Text="Tool offset (Offset):" Margin="2,5,0,2" FontWeight="Bold"/>
                                    <UniformGrid Columns="6">
                                        <TextBlock Text="X" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="Y" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="Z" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="RX" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="RY" Style="{StaticResource LabelStyle}"/>
                                        <TextBlock Text="RZ" Style="{StaticResource LabelStyle}"/>
                                    </UniformGrid>
                                    <UniformGrid Columns="6" Margin="0,2,0,5">
                                        <TextBox Text="{Binding ToolOffX}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding ToolOffY}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding ToolOffZ}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding ToolOffRX}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding ToolOffRY}" Style="{StaticResource InputBoxStyle}"/>
                                        <TextBox Text="{Binding ToolOffRZ}" Style="{StaticResource InputBoxStyle}"/>
                                    </UniformGrid>

                                    <Button Content="Set tool coordinate system" Command="{Binding SetToolFrameCommand}" Height="35" Background="LightSkyBlue" Style="{StaticResource TaskBtnStyle}"/>
                                </StackPanel>
                            </GroupBox>
                        </StackPanel>
                    </ScrollViewer>

                    <Grid Grid.Row="2" Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="Pause" 
                                Command="{Binding PauseCommand}" 
                                Height="40" Margin="10,5" 
                                Background="#FFFACD" FontWeight="Bold"
                                Style="{StaticResource TaskBtnStyle}"/>

                        <Button Grid.Column="1" Content="Resume" 
                                Command="{Binding ResumeCommand}" 
                                Height="40" Margin="10,5" 
                                Background="#E0FFFF" FontWeight="Bold"
                                Style="{StaticResource TaskBtnStyle}"/>
                    </Grid>

                    <Grid Grid.Row="3" Margin="0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="Pivot Position" Command="{Binding HomeCommand}" Height="40" Margin="10,0" Background="LightCyan" Style="{StaticResource TaskBtnStyle}"/>
                        <Button Grid.Column="1" Content="Stop" Command="{Binding StopCommand}" Height="40" Margin="10,0" Background="#FFCCCC" FontWeight="Bold" Style="{StaticResource TaskBtnStyle}"/>
                    </Grid>
                </Grid>
            </GroupBox>
        </Grid>
    </Grid>
</Window>